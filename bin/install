#!/usr/bin/env bash

set -e
set -o pipefail
#set -u

echo  ASDF_INSTALL_TYPE:       ${ASDF_INSTALL_TYPE}
echo  ASDF_INSTALL_VERSION:    ${ASDF_INSTALL_VERSION}
echo  ASDF_INSTALL_PATH:       ${ASDF_INSTALL_PATH}
echo
echo  ASDF_CONCURRENCY:        ${ASDF_CONCURRENCY}
echo  ASDF_DOWNLOAD_PATH:      ${ASDF_DOWNLOAD_PATH}
echo
echo  ASDF_PLUGIN_PATH:        ${ASDF_PLUGIN_PATH}
echo  ASDF_PLUGIN_SOURCE_URL:  ${ASDF_PLUGIN_SOURCE_URL}
echo  ASDF_PLUGIN_PREV_REF:    ${ASDF_PLUGIN_PREV_REF}
echo  ASDF_PLUGIN_POST_REF:    ${ASDF_PLUGIN_POST_REF}
echo
echo  ASDF_CMD_FILE:           ${ASDF_CMD_FILE}

PLUGIN_BIN_PATH="$(dirname -- "${BASH_SOURCE[0]}")"
echo PLUGIN_BIN_PATH: $PLUGIN_BIN_PATH
REPO_URL_PATH="$PLUGIN_BIN_PATH/repo_url"
echo REPO_URL_PATH: $REPO_URL_PATH
REPO_URL="$(head $REPO_URL_PATH)"
echo REPO_URL: $REPO_URL

git clone --filter=blob:none --no-checkout --branch ${ASDF_INSTALL_VERSION} --depth 1 --sparse https://github.com/karandit/til ${ASDF_INSTALL_PATH}
git -C ${ASDF_INSTALL_PATH} sparse-checkout add scripts
git -C ${ASDF_INSTALL_PATH} checkout
